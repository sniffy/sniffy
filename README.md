JDBC Sniffer
============
[![CI Status](https://travis-ci.org/bedrin/jdbc-sniffer.svg?branch=develop)](https://travis-ci.org/bedrin/jdbc-sniffer)

JDBC Sniffer counts the number of executed SQL queries and provides an API for validating it and reseting to 0
It is very useful in unit tests and allows you to test if particular method doesn't make more than N SQL queries

Maven
============
JDBC Sniffer is available from Maven Central repository
```xml
<dependency>
    <groupId>com.github.bedrin</groupId>
    <artifactId>jdbc-sniffer</artifactId>
    <version>1.2</version>
</dependency>
```

Download
============
- [jdbc-sniffer-1.2.jar](https://github.com/bedrin/jdbc-sniffer/releases/download/1.2/jdbc-sniffer-1.2.jar)
- [jdbc-sniffer-1.2-sources.jar](https://github.com/bedrin/jdbc-sniffer/releases/download/1.2/jdbc-sniffer-1.2-sources.jar)
- [jdbc-sniffer-1.2-javadoc.jar](https://github.com/bedrin/jdbc-sniffer/releases/download/1.2/jdbc-sniffer-1.2-javadoc.jar)

Setup
============
Simply add jdbc-sniffer.jar to your classpath and add `sniffer:` prefix to the JDBC connection url
For example `jdbc:h2:~/test` should be changed to `sniffer:jdbc:h2:~/test`

Validating the number of queries
============
The number of executed queries is available via static methods of two classes:
`com.github.bedrin.jdbc.sniffer.Sniffer` and `com.github.bedrin.jdbc.sniffer.ThreadLocalSniffer`

First one holds the number of SQL queries executed by all threads, while the later holds the number of SQL queries generated by current thread only

```java
@Test
public void testExecuteStatement() throws ClassNotFoundException, SQLException {
    // Just add sniffer: in front of your JDBC connection URL in order to enable sniffer
    Connection connection = DriverManager.getConnection("sniffer:jdbc:h2:~/test", "sa", "sa");
    connection.createStatement().execute("SELECT 1 FROM DUAL");
    // Sniffer.executedStatements() returns count of execute queries
    assertEquals(1, Sniffer.executedStatements());
    // Sniffer.verifyNotMoreThanOne() throws an IllegalStateException if more than one query was executed; it also resets the counter to 0
    Sniffer.verifyNotMoreThanOne();
    // Sniffer.verifyNotMore() throws an IllegalStateException if any query was executed
    Sniffer.verifyNotMore();
}
```

Building
============
JDBC sniffer is built using JDK8+ and Maven 3+ - just checkout the project and type `mvn install`

Checksum
============
SHA-1 checksum for `jdbc-sniffer-1.2.jar` is `524778edf2eabbd22c2ae69a0ca1382cc79318c2`
